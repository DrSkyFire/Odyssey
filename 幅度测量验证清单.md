# 幅度测量验证测试清单

## 测试目标
验证修复后的幅度测量模块是否正确工作，确定是否需要硬件衰减补偿。

## 测试环境准备
- [x] 信号发生器（能输出精确幅度的正弦波）
- [x] 示波器（用于验证实际输入幅度）
- [x] FPGA测试板
- [x] 测试记录表格

---

## 测试1：零点和噪声底测试

### 目的
确认无信号时的噪声底和零点漂移

### 步骤
1. 信号输入接GND
2. 观察幅度显示值
3. 记录10秒内的最大/最小值

### 判定标准
- ✅ 通过：amplitude_out < 100mV
- ⚠️ 警告：100mV ≤ amplitude_out < 200mV（噪声偏大）
- ❌ 失败：amplitude_out ≥ 200mV（异常）

### 实测结果
- 平均值：14 mV
- 抖动范围：+-1 mV
- 判定：[x] 通过 [] 警告 [ ] 失败

---

## 测试2：标准幅度测试（确定衰减系数）

### 目的
通过已知幅度信号确定硬件衰减比

### 测试表格

| 测试点 | 输入Vpp | 示波器读数 | FPGA显示值 | 理论值(无衰减) | 衰减比K | 判定 |
|--------|---------|------------|------------|----------------|---------|------|
| 1      | 1.000V  | 1.03 V   | 340 mV  | 1000mV         | 2.94 | [ ]  |
| 2      | 2.000V  | 2.02 V   | 657 mV  | 2000mV         | 3.04 | [ ]  |
| 3      | 3.000V  | 3.04 V   | 992 mV  | 3000mV         | 3.02 | [ ]  |

### 计算衰减系数
```
K = 理论值 / FPGA显示值

示例：
- 输入 1.000V
- FPGA显示 333mV
- K = 1000 / 333 = 3.0
→ 需要×3补偿
```

### 衰减系数判定
- K = 1.0 ± 0.1：无需补偿 ✅
- K = 2.0 ± 0.2：需要×2补偿 ⚠️
- K = 3.0 ± 0.3：需要×3补偿 ⚠️
- 其他：需要自定义补偿 ❌

**实测衰减系数 K = 3**

---

## 测试3：线性度测试

### 目的
验证幅度测量的线性关系

### 测试表格

| 输入Vpp | FPGA显示(mV) | 补偿后(×K) | 误差(%) |
|---------|--------------|------------|---------|
| 0.5V    | 176 | 528 | 5.6 |
| 1.0V    | 340 | 1020 | 2 |
| 1.5V    | 507 | 1521 | 1.4 |
| 2.0V    | 665 | 1995 | 0.25 |
| 2.5V    | 824 | 2472 | 1.12 |
| 3.0V    | 991 | 2973 | 0.9 |

### 判定标准
- ✅ 通过：所有测试点误差 < ±5%
- ⚠️ 警告：部分测试点误差 5% ~ 10%
- ❌ 失败：误差 > 10% 或非线性

### 线性度评估
- 最大误差：5.6 %
- 平均误差：1.87 %
- 判定：[ ] 通过 [x] 警告 [ ] 失败

---

## 测试4：稳定性测试

### 目的
验证滤波器效果，确认显示稳定性

### 步骤
1. 输入固定幅度信号（建议2.0Vpp）
2. 持续观察60秒
3. 记录每10秒的读数

### 测试表格

| 时间(s) | 幅度显示(mV) | 与平均值偏差(mV) |
|---------|-----|------------------|
| 10      | 657 | 0 |
| 20      | 657 | 0 |
| 30      | 657 | 0 |
| 40      | 657 | 0 |
| 50      | 657 | 0 |
| 60      | 657 | 0 |

### 判定标准
- ✅ 通过：抖动 < ±2%
- ⚠️ 警告：抖动 2% ~ 5%
- ❌ 失败：抖动 > 5%

### 稳定性评估
- 平均值：657 mV
- 最大抖动：0 mV (0 %)
- 判定：[x] 通过 [ ] 警告 [ ] 失败

---

## 测试5：频率响应测试

### 目的
验证不同频率下幅度测量的一致性

### 测试表格
固定幅度2.0Vpp，改变频率

| 频率 | FPGA显示(mV) | 误差(%) | 判定 |
|------|--------------|---------|------|
| 100Hz  | 657 | 0  | [x]  |
| 1kHz   | 657 | 0  | [x]  |
| 10kHz  | 657 | 0  | [x]  |
| 100kHz | 657 | 0  | [x]  |
| 1MHz   | 639 | 2.7  | [x]  |

### 判定标准
- ✅ 通过：所有频率点误差 < ±5%
- ⚠️ 警告：高频或低频衰减 5% ~ 10%
- ❌ 失败：某频率段误差 > 10%

---

## 代码修改指南（根据测试结果）

### 情况1：K ≈ 1.0（无衰减）
**无需修改**，当前代码已经正确。

### 情况2：K ≈ 2.0（需要×2补偿）
修改 `signal_parameter_measure.v` 第750行左右：
```verilog
// 修改前：
amp_result <= amp_mult[25:10];

// 修改后：
amp_result <= amp_mult[25:10] << 1;  // ×2倍
```

### 情况3：K ≈ 3.0（需要×3补偿）
修改 `signal_parameter_measure.v` 第750行左右：
```verilog
// 修改前：
amp_result <= amp_mult[25:10];

// 修改后：
amp_result <= (amp_mult[25:10] * 16'd3);  // ×3倍
```

### 情况4：K为其他值（如2.8）
修改 `signal_parameter_measure.v` 第735行左右的乘法系数：
```verilog
// 修改前：
amp_mult <= {22'd0, amp_diff} * 32'd3300;

// 修改后（以K=2.8为例）：
amp_mult <= {22'd0, amp_diff} * 32'd9240;  // 3300 × 2.8
```

---

## 综合评估

### 所有测试结果汇总
- [x] 测试1 - 零点噪声：**通过** ✅ (14mV，抖动±1mV)
- [x] 测试2 - 标准幅度：**需要补偿** ⚠️ (K=3.0)
- [x] 测试3 - 线性度：**警告** ⚠️ (最大误差5.6%，平均1.87%)
- [x] 测试4 - 稳定性：**完美通过** ✅ (0抖动)
- [x] 测试5 - 频率响应：**通过** ✅ (1MHz处2.7%衰减)

### 最终判定
- [ ] ✅ 全部通过 - 无需修改
- [x] ⚠️ 需要补偿 - K = **3.0** - 已应用×3补偿修改
- [ ] ❌ 存在问题 - 需要进一步调试

### 关键发现
1. **硬件衰减确认**：原注释中的1:3衰减比是正确的
2. **滤波器效果**：4次滑动平均滤波器工作完美，实现0抖动
3. **频率响应**：100Hz~100kHz频段完全一致，1MHz轻微衰减正常
4. **线性度**：中高量程线性度优秀（<2%），低量程（0.5V）误差稍大

### 已应用的代码修改
- 文件：`signal_parameter_measure.v` 第746行
- 修改：`amp_result <= (amp_mult[25:10] * 16'd3);`
- 效果：应用×3硬件衰减补偿
- 预期结果：
  - 1V输入 → 显示约1020mV (原340mV × 3)
  - 2V输入 → 显示约1971mV (原657mV × 3)
  - 3V输入 → 显示约2976mV (原992mV × 3)

### 建议后续验证
1. 重新编译并烧录FPGA
2. 重复测试2和测试3，验证补偿效果
3. 确认补偿后误差是否降至±5%以内

### 备注
```
测试总结：
- 所有核心功能正常工作
- 滤波器设计成功，稳定性极佳
- 硬件衰减已通过实测确认
- 代码已更新，待重新验证

特殊发现：
- 0.5V测试点误差较大（5.6%），可能是ADC在低量程时的非线性
- 建议实际使用时避免测量<500mV的信号，或考虑分段校准
```

---

## 测试人员签名
- 测试人：DrSkyFire
- 日期：2025-11-04
- 审核人：GitHub Copilot
