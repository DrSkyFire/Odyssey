=============================================================================
 时域波形显示功能说明
=============================================================================
Git提交: 58b0c48
日期: 2025-10-24

-----------------------------------------------------------------------------
 新增功能概述
-----------------------------------------------------------------------------

添加了时域波形显示模式，可以直接在HDMI屏幕上查看ADC采集的原始波形。
这是调试ADC采集链路的重要工具，独立于FFT模块。

-----------------------------------------------------------------------------
 工作模式说明
-----------------------------------------------------------------------------

系统现在有3种工作模式，通过按键切换（user_button[1]）：

【模式0 - 时域波形】(默认) ⭐
- HDMI显示: 绿色波形，以中心线为0V参考
- 适用场景: 
  * 首次调试，验证ADC是否正常采集
  * 查看原始波形形状
  * 检查信号幅度和偏置
- UART显示: "Mode:T"

【模式1 - 频域频谱】
- HDMI显示: 彩色柱状频谱图
- 适用场景:
  * FFT输出验证
  * 频率成分分析
  * 谐波观察
- UART显示: "Mode:F"

【模式2 - 参数测量】
- HDMI显示: 参数文字显示（频率/幅度/占空比/THD/相位差）
- 适用场景:
  * 精确测量信号参数
  * 自动测试判断
- UART显示: "Mode:M"

-----------------------------------------------------------------------------
 时域波形显示原理
-----------------------------------------------------------------------------

1. 数据源:
   - 直接使用 time_data 输入（连接到 adc_data_ext）
   - 10位ADC数据扩展到16位
   - 数据范围: 0-1023

2. 映射方式:
   - X轴: 1920像素 → 1024采样点（约2:1）
   - Y轴: 波形以屏幕中心线为参考（0V基准）
   - 缩放: ADC值 * 0.625 ≈ 显示高度

3. 显示特征:
   - 波形颜色: 绿色 (24'h00FF00)
   - 中心参考线: 灰色 (24'h606060)
   - 网格线: 深灰色 (24'h303030)
   - 波形线宽: 3像素

-----------------------------------------------------------------------------
 UART调试输出格式（新）
-----------------------------------------------------------------------------

每0.5秒输出3行信息：

第1行: HDMI: 1 1 1 1
       ↑     ↑ ↑ ↑ ↑
       |     | | | └── MS7210初始化状态 (0/1)
       |     | | └──── HDMI时钟状态 (0/1)
       |     | └────── PLL2锁定 (0/1)
       |     └──────── PLL1锁定 (0/1)
       └────────────── 标识符

第2行: Mode:T
             ↑
             └── 工作模式: T=时域 / F=频域 / M=测量

第3行: ADC:1 FIFO:0026 FFT:1 0000
       ↑   ↑ ↑    ↑    ↑  ↑ ↑
       |   | |    |    |  | └── FFT输出计数
       |   | |    |    |  └──── FFT完成标志
       |   | |    |    └─────── 标识符
       |   | |    └──────────── FIFO写入计数
       |   | └───────────────── 标识符
       |   └─────────────────── ADC数据有效标志
       └─────────────────────── 标识符

-----------------------------------------------------------------------------
 使用步骤
-----------------------------------------------------------------------------

【首次上电 - 验证ADC采集】

1. 上电后默认进入时域模式（Mode:T）

2. 观察HDMI屏幕:
   - 应该看到绿色波形从左到右扫描
   - 如果ADC有输入信号，波形应该上下跳动
   - 如果没有输入，波形应该在中心线附近（噪声）

3. 检查UART输出:
   ```
   HDMI: 1 1 1 1    <- 所有系统正常
   Mode:T           <- 时域模式
   ADC:1 FIFO:0026 FFT:1 0000  <- ADC有效, FIFO在写入
   ```

4. 判断:
   - ✅ ADC正常: 波形跳动，FIFO计数递增
   - ❌ ADC异常: 波形静止，ADC:0（数据无效）

【切换到频域模式】

5. 按下 user_button[1]（MODE按键）

6. UART显示变为: Mode:F

7. 观察HDMI屏幕:
   - 应该看到彩色柱状频谱图
   - FFT counter应该开始递增（如果auto_start已触发）

【再次切换到参数测量】

8. 再按 user_button[1]

9. UART显示: Mode:M

10. HDMI显示参数文字（频率/幅度等）

【循环切换】

11. 再按一次回到时域模式（Mode:T）

-----------------------------------------------------------------------------
 调试技巧
-----------------------------------------------------------------------------

1. 如果看不到波形:
   - 检查ADC供电是否正常
   - 确认adc_ch1_data/ch2_data有数据输入
   - 用示波器测量ADC输出引脚

2. 如果波形异常:
   - 过高/过低: 检查ADC参考电压
   - 抖动严重: 检查时钟质量
   - 翻转: 可能数据位序反了

3. 时域vs频域对照:
   - 时域看到正弦波 → 频域应该有单根谱线
   - 时域看到方波 → 频域有基波+奇次谐波
   - 时域无信号 → 频域应该全是低幅度噪声

4. UART监控:
   - FIFO计数应该持续递增（0-1023循环）
   - 如果FIFO计数不变，说明ADC没有写入
   - FFT计数只在Mode:F时递增

-----------------------------------------------------------------------------
 代码改动摘要
-----------------------------------------------------------------------------

hdmi_display_ctrl.v:
  - 新增时域波形参数: time_data_q, waveform_height
  - 新增localparam: WAVEFORM_CENTER_Y
  - 修改RGB生成逻辑: 根据work_mode选择绘制时域/频域
  - 时域绘制: 中心线 + 绿色波形 + 网格

signal_analyzer_top.v:
  - 修改work_mode默认值: 2'd1 → 2'd0 (频域→时域)
  - UART状态机新增: 8'd14-8'd20 (Mode信息发送)
  - UART输出格式: 3行（HDMI状态 + Mode + ADC/FFT）

-----------------------------------------------------------------------------
 已知限制
-----------------------------------------------------------------------------

1. 时域波形绘制方式:
   - 当前使用简化的"点绘制"而非连续线条
   - 可能在某些情况下显示不够平滑
   - 未来可优化为Bresenham线条算法

2. 波形更新速率:
   - 受限于spectrum_addr扫描速度
   - 大约每帧更新一次（60Hz）
   - 足够观察慢速信号，快速瞬态可能错过

3. Y轴缩放固定:
   - 目前缩放比例硬编码
   - 不支持动态调整幅度范围
   - 未来可添加按键控制增益

-----------------------------------------------------------------------------
 下一步优化方向
-----------------------------------------------------------------------------

1. 线条平滑化:
   - 实现Bresenham线条算法
   - 或者使用抗锯齿插值

2. 触发模式:
   - 添加边沿触发（上升/下降）
   - 实现稳定的波形显示

3. 光标测量:
   - 添加可移动光标
   - 显示光标处的电压值和时间

4. 多通道叠加:
   - 同时显示CH1和CH2
   - 不同颜色区分

=============================================================================
