# FPGA智能信号分析与测试系统

## 📋 项目简介

**Odyssey** 是一个基于FPGA的高性能双通道信号分析与测试系统，集成了示波器、频谱分析仪、信号发生器和自动测试仪的核心功能。系统采用盘古FPGA（PGL50H）为主控芯片，配合双路10位ADC（MS9280）实现高速信号采集，通过HDMI接口实时显示测量结果。

### 核心特性

- **双通道同步采集**：MS9280 ADC，10位分辨率，35MHz采样率，支持2路信号同步
- **高精度频谱分析**：8192点FFT，汉宁窗加权，频率分辨率4.27kHz
- **全面参数测量**：
  - 频率：10Hz ~ 17.5MHz，精度<0.1%（FFT模式）
  - 幅度：峰峰值测量，精度±1%
  - 占空比：0~100%，精度±0.1%
  - THD：2-5次谐波分析，精度±0.5%
  - 相位差：双通道相位差测量，精度<1°
- **微弱信号检测**：锁相放大技术，可检测<10mV信噪比低至-40dB的信号
- **HDMI实时显示**：720p@60Hz，参数表格+频谱波形+自动测试界面
- **智能自动测试**：可配置阈值范围，LED实时指示，支持批量测试

## 🎯 应用场景

- **电子教学实验**：波形观测、频谱分析、参数测量
- **电路板调试**：信号质量检测、时序分析、故障诊断
- **自动化测试**：批量产品检测、参数筛选、合格判定
- **射频信号分析**：频谱扫描、谐波失真检测
- **科研实验**：微弱信号检测、锁相放大应用

## 🏗️ 系统架构

```
┌─────────────────────────────────────────────────────────────┐
│                    FPGA主控芯片 (PGL50H)                     │
│                                                               │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐    │
│  │  ADC采集 │  │FFT频谱   │  │参数测量  │  │HDMI显示  │    │
│  │  模块    │─→│分析模块  │─→│模块      │─→│控制模块  │────┼──→ HDMI
│  │ (35MHz)  │  │(8192点)  │  │(6参数)   │  │(720p)    │    │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘    │
│       ↓              ↓              ↓              ↑         │
│  ┌──────────────────────────────────────────────────┐      │
│  │          系统时钟管理 (PLL + 时钟域同步)          │      │
│  └──────────────────────────────────────────────────┘      │
│       ↓              ↓              ↓              ↓         │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐  │
│  │相位差测量│  │微弱信号  │  │自动测试  │  │UART调试  │  │
│  │模块      │  │检测模块  │  │模块      │  │模块      │  │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘  │
│       ↓              ↓              ↓              ↓         │
└───────┼──────────────┼──────────────┼──────────────┼────────┘
        ↓              ↓              ↓              ↓
   [按键控制]    [LED指示]      [测试接口]      [串口调试]
```

### 时钟域划分

| 时钟域 | 频率 | 用途 | PLL来源 |
|--------|------|------|---------|
| `clk_100m` | 100MHz | 系统主时钟、参数测量 | PLL1 |
| `clk_adc` | 35MHz | ADC采样时钟 | PLL1 |
| `clk_hdmi_pixel` | 74.25MHz | HDMI像素时钟（720p） | PLL2 |
| `clk_10m` | 10MHz | MS7210配置时钟 | PLL2 |

### 数据流向

```
ADC输入 → FIFO缓存 → FFT运算 → 频谱计算 → 参数测量 → HDMI显示
   ↓                    ↓            ↓            ↓
 溢出检测          基波提取      过零检测     自动测试判断
   ↓                    ↓            ↓            ↓
LED报警            THD计算       占空比      阈值比较LED
```

## 📊 性能指标

### 采集性能
- **采样率**：35MSPS（每通道）
- **分辨率**：10位（1024级）
- **输入范围**：0 ~ 3.3V（单端）
- **带宽**：DC ~ 17.5MHz（-3dB）
- **通道数**：2路同步采集

### 测量精度
- **频率测量**：
  - FFT模式：10Hz ~ 17.5MHz，精度<0.1%
  - 过零模式：10Hz ~ 1MHz，精度~1%
- **幅度测量**：0 ~ 3300mV，精度±1%
- **占空比测量**：0 ~ 100%，精度±0.1%
- **THD测量**：0 ~ 100%，精度±0.5%（2-5次谐波）
- **相位差测量**：-180° ~ +180°，精度<1°

### 显示性能
- **分辨率**：1280×720（720p）
- **刷新率**：60Hz
- **更新率**：参数10Hz，频谱5Hz
- **延迟**：<100ms（采集到显示）

### 资源使用
- **逻辑单元**：~45000 / 49152（92%）
- **RAM**：~180KB / 468KB（38%）
- **DSP**：32 / 32（100%）
- **PLL**：2 / 4（50%）

## 🔧 硬件平台

### 主控板
- **FPGA型号**：盘古PGL50H（Pango PGL50H-6IMBG484）
- **逻辑单元**：49152 LUT4
- **存储资源**：468KB RAM + 2.4MB BSRAM
- **DSP模块**：32个硬核DSP
- **PLL数量**：4个

### 外设接口
- **ADC芯片**：2×MS9280（10位，35MSPS）
- **HDMI输出**：MS7210驱动芯片
- **用户接口**：8×按键 + 8×LED
- **调试接口**：UART（115200bps）
- **电源**：5V/2A供电

## 📁 项目结构

```
Odyssey_proj/
├── source/
│   ├── source/                          # 核心Verilog源文件
│   │   ├── signal_analyzer_top.v        # 顶层模块（3115行）
│   │   ├── adc_capture_dual.v           # 双通道ADC采集
│   │   ├── dual_channel_fft_controller.v # FFT控制器
│   │   ├── signal_parameter_measure.v   # 参数测量模块
│   │   ├── dual_channel_phase.v         # 相位差测量
│   │   ├── weak_signal_detector.v       # 微弱信号检测
│   │   ├── hdmi_display_ctrl.v          # HDMI显示控制（3299行）
│   │   ├── auto_test.v                  # 自动测试模块
│   │   └── ...                          # 其他辅助模块
│   ├── pll_sys/                         # 系统PLL IP核
│   └── pll_hdmi/                        # HDMI PLL IP核
├── ipcore/
│   └── fft_8192/                        # 8192点FFT IP核
├── sim/                                 # 仿真文件
├── compile/                             # 综合结果
├── place_route/                         # 布局布线结果
├── docs/                                # 文档目录（本目录）
└── README.md                            # 主文档

总代码量：~15000行Verilog
核心模块：12个
IP核：3个（FFT、PLL×2）
```

## 🚀 快速开始

### 最小启动步骤

1. **上电启动**：连接5V电源，等待3秒PLL锁定
2. **连接信号**：将待测信号接入CH1/CH2（0-3.3V）
3. **连接显示**：HDMI线连接到显示器（支持720p）
4. **开始测试**：按下`Button[0]`（RUN/STOP）开始采集

### 模式切换

- `Button[3]`：工作模式（时域/频域/FFT频谱）
- `Button[4]`：通道选择（CH1/CH2/双通道）
- `Button[5]`：自动测试模式
- `Button[1]`：微弱信号检测模式

详细使用说明请参见 [**使用指南**](06_使用指南.md)

## 📖 文档导航

1. [**项目概述**](01_项目概述.md)（当前文档）
2. [**硬件接口说明**](02_硬件接口.md)
3. [**核心模块文档**](03_核心模块.md)
4. [**使用指南**](04_使用指南.md)
5. [**开发文档**](05_开发文档.md)
6. [**更新日志**](06_更新日志.md)

## 📜 版本信息

- **当前版本**：v2.0（时序优化版）
- **发布日期**：2025年11月
- **作者**：DrSkyFire
- **许可证**：MIT License

## 🎓 技术亮点

### 1. 时序优化技术
- **多级流水线设计**：FFT运算3级流水线，延迟<10ns
- **查找表优化**：BCD转换、SNR计算使用LUT代替除法
- **跨时钟域同步**：异步FIFO + 握手信号，避免亚稳态
- **时钟域隔离**：ADC/HDMI/系统三时钟域独立运行

### 2. 信号处理算法
- **汉宁窗加权**：旁瓣抑制-31dB，频率泄漏<1%
- **峰值插值**：提高频率分辨率10倍（0.427kHz）
- **自适应阈值**：支持±50%直流偏移的占空比测量
- **锁相放大**：数字正交解调，等效带宽<1Hz

### 3. 资源优化
- **双通道时分复用**：单FFT核处理2路信号，节省50%资源
- **动态压缩存储**：频谱数据16→8位压缩，节省RAM
- **BCD预计算**：HDMI显示数据在场消隐期处理，避免时序违例

---

**下一步**：请阅读 [硬件接口说明](02_硬件接口.md) 了解详细的接口定义和连接方法。
