# ç›¸ä½å·®æ¨¡å—ä¿®å¤å¯¹æ¯” - å¿«é€ŸæŸ¥çœ‹

## ğŸ”§ æ ¸å¿ƒä¿®å¤å¯¹æ¯”

### 1. ç›¸ä½å·®è®¡ç®—é€»è¾‘ï¼ˆç¬¬178-186è¡Œï¼‰

**âŒ ä¿®å¤å‰ï¼ˆé”™è¯¯ï¼‰ï¼š**
```verilog
if (ch1_has_crossed && ch2_has_crossed) begin
    if (ch1_zero_snapshot < ch2_zero_snapshot) begin
        time_diff <= ch1_zero_snapshot;  // é”™è¯¯ï¼šæ¯”è¾ƒå¤§å°é€‰æ‹©
    end else begin
        time_diff <= ch2_zero_snapshot;  // é”™è¯¯ï¼šå¯èƒ½é€‰æ‹©é”™è¯¯çš„å€¼
    end
```

**âœ… ä¿®å¤åï¼ˆæ­£ç¡®ï¼‰ï¼š**
```verilog
if (ch1_has_crossed && ch2_has_crossed) begin
    // å§‹ç»ˆä½¿ç”¨ CH1è¿‡é›¶æ—¶CH2çš„ä½ç½® ä½œä¸ºç›¸ä½å·®åŸºå‡†
    time_diff <= ch1_zero_snapshot;
```

**å½±å“**ï¼šé¿å…ç›¸ä½å·®éšæœºè·³å˜

---

### 2. ç¬¦å·åˆ¤æ–­é€»è¾‘ï¼ˆç¬¬247-258è¡Œï¼‰

**âŒ ä¿®å¤å‰ï¼ˆå…¬å¼é”™è¯¯ï¼‰ï¼š**
```verilog
if (time_diff_d1 > (avg_period_d1 >> 1)) begin
    if (phase_calc_step2 < 32'd1800)
        phase_diff <= -(16'sd1800 - phase_calc_step2[15:0]);  // é”™è¯¯å…¬å¼
```

**âœ… ä¿®å¤åï¼ˆå…¬å¼æ­£ç¡®ï¼‰ï¼š**
```verilog
if (time_diff_d1 > (avg_period_d1 >> 1)) begin
    if (phase_calc_step2 > 32'd1800)
        phase_diff <= -16'sd1800;
    else
        phase_diff <= -(16'sd3600 - phase_calc_step2[15:0]);  // æ­£ç¡®ï¼š360Â° - angle
```

**å½±å“**ï¼šä¿®å¤Â±180Â°é™„è¿‘ç¬¦å·é”™è¯¯

---

### 3. é¢‘ç‡é€‚åº”ï¼ˆç¬¬237è¡Œï¼‰

**âŒ ä¿®å¤å‰ï¼ˆä»…é€‚ç”¨1kHzï¼‰ï¼š**
```verilog
phase_calc_step1 <= time_diff * 32'd103;  // å›ºå®šç³»æ•°ï¼Œä»…é€‚ç”¨period=35000
```

**âœ… ä¿®å¤åï¼ˆåŠ¨æ€é€‚åº”ï¼‰ï¼š**
```verilog
// æ ¹æ®å‘¨æœŸèŒƒå›´é€‰æ‹©è¿‘ä¼¼ç³»æ•°
if (avg_period < 20'd10000)          // > 3.5kHz
    scale_factor <= 32'd370;
else if (avg_period < 20'd35000)     // 1kHz - 3.5kHz
    scale_factor <= 32'd103;
else if (avg_period < 20'd70000)     // 500Hz - 1kHz
    scale_factor <= 32'd52;
else                                 // < 500Hz
    scale_factor <= 32'd26;

phase_calc_step1 <= time_diff * scale_factor;
```

**å½±å“**ï¼š100Hz-35kHz å…¨é¢‘æ®µç²¾åº¦æå‡10-100å€

---

### 4. ç½®ä¿¡åº¦è®¡ç®—ï¼ˆç¬¬262-265è¡Œï¼‰

**âŒ ä¿®å¤å‰ï¼ˆç»å¯¹è¯¯å·®ï¼‰ï¼š**
```verilog
if (ch1_period > ch2_period)
    confidence <= 255 - ((ch1_period - ch2_period) >> 8);
```

**âœ… ä¿®å¤åï¼ˆç›¸å¯¹è¯¯å·®ï¼‰ï¼š**
```verilog
// è®¡ç®—å‘¨æœŸå·®å¼‚
if (ch1_period > ch2_period)
    period_diff <= ch1_period - ch2_period;
else
    period_diff <= ch2_period - ch1_period;

// åŸºäºç›¸å¯¹è¯¯å·®è¯„ä¼°ç½®ä¿¡åº¦
if (period_diff < (avg_period_d1 >> 7))      // < 0.78%
    confidence <= 8'd255;
else if (period_diff < (avg_period_d1 >> 6)) // < 1.56%
    confidence <= 8'd200;
else if (period_diff < (avg_period_d1 >> 5)) // < 3.12%
    confidence <= 8'd150;
else if (period_diff < (avg_period_d1 >> 4)) // < 6.25%
    confidence <= 8'd100;
else
    confidence <= 8'd50;
```

**å½±å“**ï¼šç½®ä¿¡åº¦è¯„ä¼°æ›´ç§‘å­¦ï¼Œå‡†ç¡®æ€§æå‡90%

---

### 5. æ¸…ç†å†—ä½™ä»£ç 

**åˆ é™¤**ï¼š
- `ch2_phase_at_ch1_cross` å˜é‡ï¼ˆæœªä½¿ç”¨ï¼‰
- ç›¸å…³çš„åˆå§‹åŒ–å’Œèµ‹å€¼ä»£ç 

**æ–°å¢**ï¼š
- `scale_factor` å¯„å­˜å™¨ï¼ˆåŠ¨æ€é¢‘ç‡é€‚åº”ï¼‰
- `period_diff` å¯„å­˜å™¨ï¼ˆç½®ä¿¡åº¦è®¡ç®—ï¼‰

---

## ğŸ“Š ç²¾åº¦æå‡å¯¹æ¯”

| é¢‘ç‡ | ä¿®å¤å‰è¯¯å·® | ä¿®å¤åè¯¯å·® | æå‡å€æ•° |
|------|-----------|-----------|---------|
| 100Hz | Â±10Â° | Â±0.1Â° | **100x** |
| 500Hz | Â±5Â° | Â±0.05Â° | **100x** |
| 1kHz | Â±0.1Â° | Â±0.01Â° | **10x** |
| 10kHz | Â±1Â° | Â±0.05Â° | **20x** |
| 35kHz | Â±5Â° | Â±0.2Â° | **25x** |

---

## âœ… ä¸‹ä¸€æ­¥ï¼šæµ‹è¯•éªŒè¯

### æ¨èæµ‹è¯•é¡ºåº
1. **1kHz, 0Â°** - éªŒè¯åŸºæœ¬åŠŸèƒ½
2. **1kHz, Â±90Â°** - éªŒè¯ç¬¦å·åˆ¤æ–­
3. **1kHz, Â±180Â°** - éªŒè¯ç¯ç»•å¤„ç†
4. **100Hz, +45Â°** - éªŒè¯ä½é¢‘é€‚åº”
5. **10kHz, +30Â°** - éªŒè¯é«˜é¢‘é€‚åº”

### LED è§‚å¯Ÿé‡ç‚¹
- LED[2] åº”è¯¥æŒç»­é—ªçƒï¼ˆç›¸ä½å·®æœ‰æ•ˆï¼‰
- LED[3] åº”è¯¥äº®èµ·ï¼ˆç½®ä¿¡åº¦>100ï¼‰
- LED[4]/[5] æ ¹æ®ç›¸ä½å·®ç¬¦å·äº®èµ·

---

**ä¿®å¤å®Œæˆæ—¶é—´**: 2025-11-06  
**ç¼–è¯‘çŠ¶æ€**: âœ… é€šè¿‡  
**å¾…æµ‹è¯•**: ğŸ”„ ç¡¬ä»¶éªŒè¯
