# è‡ªåŠ¨æµ‹è¯•æ¨¡å—é—®é¢˜æ£€æŸ¥æŠ¥å‘Š

**æ—¥æœŸ**ï¼š2025å¹´11æœˆ7æ—¥  
**æ£€æŸ¥é¡¹ç›®**ï¼šauto_test æ¨¡å—çš„è¾“å…¥ä¿¡å·å’Œæ£€æµ‹é€»è¾‘  
**çŠ¶æ€**ï¼šğŸ”´ å‘ç°ä¸¥é‡é—®é¢˜  

---

## ğŸš¨ é—®é¢˜1ï¼šè¾“å…¥ä¿¡å·æœªå®šä¹‰ï¼ˆä¸¥é‡ï¼‰

### é—®é¢˜æè¿°
`auto_test` æ¨¡å—çš„å‚æ•°è¾“å…¥ä¿¡å·åœ¨é¡¶å±‚æ¨¡å—ä¸­**æœªå®šä¹‰**ï¼š

**auto_test æ¨¡å—æœŸæœ›çš„è¾“å…¥**ï¼ˆLine 1741-1746ï¼‰:
```verilog
.freq           (signal_freq),        // âŒ æœªå®šä¹‰
.amplitude      (signal_amplitude),   // âŒ æœªå®šä¹‰
.duty           (signal_duty),        // âŒ æœªå®šä¹‰
.thd            (signal_thd),         // âŒ æœªå®šä¹‰
.phase_diff     (phase_difference),   // âœ… å·²å®šä¹‰
.param_valid    (param_valid),        // âŒ æœªå®šä¹‰
```

### å®é™…æƒ…å†µ
é¡¶å±‚æ¨¡å—ä¸­**å®é™…å­˜åœ¨**çš„å‚æ•°ä¿¡å·ï¼š
```verilog
// CH1 å‚æ•°ï¼ˆæ¥è‡ª signal_parameter_measure æ¨¡å—ï¼‰
wire [15:0] ch1_freq;           // âœ… å­˜åœ¨
wire        ch1_freq_is_khz;    // âœ… å­˜åœ¨  
wire        ch1_freq_is_mhz;    // âœ… å­˜åœ¨
wire [15:0] ch1_amplitude;      // âœ… å­˜åœ¨
wire [15:0] ch1_duty;           // âœ… å­˜åœ¨
wire [15:0] ch1_thd;            // âœ… å­˜åœ¨

// CH2 å‚æ•°ï¼ˆæ¥è‡ª signal_parameter_measure æ¨¡å—ï¼‰
wire [15:0] ch2_freq;           // âœ… å­˜åœ¨
wire        ch2_freq_is_khz;    // âœ… å­˜åœ¨
wire        ch2_freq_is_mhz;    // âœ… å­˜åœ¨
wire [15:0] ch2_amplitude;      // âœ… å­˜åœ¨
wire [15:0] ch2_duty;           // âœ… å­˜åœ¨
wire [15:0] ch2_thd;            // âœ… å­˜åœ¨
```

### æ ¹æœ¬åŸå› 
- `signal_freq/amplitude/duty/thd` è¿™äº›ä¿¡å·**ä»æœªå®šä¹‰**
- ç»¼åˆå™¨å¯èƒ½ä¼šï¼š
  1. æŠ¥é”™ï¼šæœªå®šä¹‰çš„ä¿¡å·
  2. æˆ–å°†å®ƒä»¬è§†ä¸ºæ‚¬ç©ºï¼ˆfloatingï¼‰ï¼Œå¯¼è‡´è‡ªåŠ¨æµ‹è¯•**æ°¸è¿œä¸é€šè¿‡**

---

## ğŸš¨ é—®é¢˜2ï¼šé¢‘ç‡æ ¼å¼ä¸åŒ¹é…

### auto_test æ¨¡å—æœŸæœ›
```verilog
input  wire [31:0]  freq,  // 32ä½é¢‘ç‡å€¼ï¼Œå•ä½Hz
```

### å®é™…å‚æ•°æ ¼å¼
```verilog
wire [15:0] ch1_freq;           // 16ä½é¢‘ç‡æ•°å€¼
wire        ch1_freq_is_khz;    // å•ä½æ ‡å¿—
wire        ch1_freq_is_mhz;    // å•ä½æ ‡å¿—
```

**å®é™…é¢‘ç‡å€¼è®¡ç®—**ï¼š
- å¦‚æœ `ch1_freq_is_mhz == 1`ï¼šå®é™…é¢‘ç‡ = `ch1_freq * 1,000,000` Hz
- å¦‚æœ `ch1_freq_is_khz == 1`ï¼šå®é™…é¢‘ç‡ = `ch1_freq * 1,000` Hz
- å¦åˆ™ï¼šå®é™…é¢‘ç‡ = `ch1_freq` Hz

### éœ€è¦è½¬æ¢
éœ€è¦å°†**3ä¸ªä¿¡å·**ï¼ˆfreq, freq_is_khz, freq_is_mhzï¼‰è½¬æ¢ä¸º**1ä¸ª32ä½Hzå€¼**ã€‚

---

## ğŸš¨ é—®é¢˜3ï¼šparam_valid ä¿¡å·æœªå®šä¹‰

### auto_test æ¨¡å—æœŸæœ›
```verilog
input  wire         param_valid,  // å‚æ•°æœ‰æ•ˆæ ‡å¿—
```

### å®é™…æƒ…å†µ
- é¡¶å±‚æ¨¡å—ä¸­**æ²¡æœ‰** `param_valid` ä¿¡å·
- å¯èƒ½çš„æ¥æºï¼š
  - `signal_parameter_measure` æ¨¡å—æ²¡æœ‰è¾“å‡º `param_valid`
  - æˆ–è€…è¾“å‡ºäº†ï¼Œä½†é¡¶å±‚æœªè¿æ¥

### å½±å“
- æ²¡æœ‰ `param_valid`ï¼Œè‡ªåŠ¨æµ‹è¯•é€»è¾‘**æ°¸è¿œä¸ä¼šæ‰§è¡Œ**ï¼š
  ```verilog
  // auto_test.v Line 586
  end else if (test_enable && param_valid) begin  // âŒ param_valid = 0
      // æ°¸è¿œä¸ä¼šè¿›å…¥è¿™é‡Œ
  ```

---

## âœ… è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šæ·»åŠ ä¿¡å·è½¬æ¢é€»è¾‘ï¼ˆæ¨èï¼‰

åœ¨ `signal_analyzer_top.v` ä¸­æ·»åŠ ï¼š

```verilog
//=============================================================================
// è‡ªåŠ¨æµ‹è¯•å‚æ•°è½¬æ¢ï¼ˆCH1å‚æ•° â†’ ç»Ÿä¸€æ ¼å¼ï¼‰
//=============================================================================
// é¢‘ç‡è½¬æ¢ï¼š16ä½+å•ä½æ ‡å¿— â†’ 32ä½Hzå€¼
reg [31:0] signal_freq;
always @(*) begin
    if (ch1_freq_is_mhz)
        signal_freq = ch1_freq * 32'd1000000;  // MHz â†’ Hz
    else if (ch1_freq_is_khz)
        signal_freq = ch1_freq * 32'd1000;     // kHz â†’ Hz
    else
        signal_freq = ch1_freq;                // å·²æ˜¯Hz
end

// å…¶ä»–å‚æ•°ç›´æ¥æ˜ å°„ï¼ˆæ ¼å¼å·²åŒ¹é…ï¼‰
wire [15:0] signal_amplitude = ch1_amplitude;
wire [15:0] signal_duty      = ch1_duty;
wire [15:0] signal_thd       = ch1_thd;

// å‚æ•°æœ‰æ•ˆæ ‡å¿—ï¼šä»»æ„æ—¶åˆ»éƒ½æœ‰æ•ˆï¼ˆå‚æ•°æŒç»­æ›´æ–°ï¼‰
wire param_valid = 1'b1;  // æˆ–ä½¿ç”¨ measure_done ä¿¡å·
```

**æ’å…¥ä½ç½®**ï¼šåœ¨ `auto_test` æ¨¡å—å®ä¾‹åŒ–**ä¹‹å‰**ï¼ˆçº¦ Line 1710ï¼‰

---

### æ–¹æ¡ˆ2ï¼šä½¿ç”¨ measure_done ä½œä¸º param_validï¼ˆæ›´å‡†ç¡®ï¼‰

å¦‚æœ `signal_parameter_measure` æ¨¡å—æœ‰ `measure_done` è¾“å‡ºï¼š

```verilog
// å‚æ•°æœ‰æ•ˆæ ‡å¿—ï¼šæµ‹é‡å®Œæˆæ—¶æœ‰æ•ˆ
wire param_valid = measure_done_ch1;  // å‡è®¾æœ‰è¿™ä¸ªä¿¡å·
```

---

## ğŸ“Š å½“å‰æ£€æµ‹é€»è¾‘åˆ†æ

### auto_test.v çš„åˆ¤æ–­é€»è¾‘
```verilog
// Line 586-599
if (test_enable && param_valid) begin
    // 1. é¢‘ç‡æµ‹è¯•
    freq_pass <= (freq >= freq_min) && (freq <= freq_max);
    
    // 2. å¹…åº¦æµ‹è¯•
    amp_pass <= (amplitude >= amp_min) && (amplitude <= amp_max);
    
    // 3. å ç©ºæ¯”æµ‹è¯•
    duty_pass <= (duty >= duty_min) && (duty <= duty_max);
    
    // 4. THDæµ‹è¯•ï¼ˆåªæœ‰ä¸Šé™ï¼‰
    thd_pass <= (thd <= thd_max);
    
    // 5. ç»¼åˆåˆ¤æ–­
    all_pass <= freq_pass && amp_pass && duty_pass && thd_pass;
end
```

### é»˜è®¤é˜ˆå€¼ï¼ˆauto_test.v Line 100-112ï¼‰
| å‚æ•° | é»˜è®¤ä¸­å¿ƒå€¼ | å®¹å·® | ä¸‹é™ | ä¸Šé™ |
|------|-----------|------|------|------|
| **é¢‘ç‡** | 100 kHz | Â±5 kHz | 95 kHz | 105 kHz |
| **å¹…åº¦** | 3000 mV (3V) | Â±500 mV | 2500 mV | 3500 mV |
| **å ç©ºæ¯”** | 600 (60%) | Â±50 (5%) | 550 (55%) | 650 (65%) |
| **THD** | - | - | - | 600 (60%) |

### åˆ¤æ–­é€»è¾‘è¯„ä¼°
- âœ… **é€»è¾‘æ­£ç¡®**ï¼šä½¿ç”¨ç®€å•çš„èŒƒå›´åˆ¤æ–­
- âœ… **é»˜è®¤å€¼åˆç†**ï¼šé€‚åˆå…¸å‹æµ‹è¯•åœºæ™¯
- âš ï¸ **é—®é¢˜**ï¼šè¾“å…¥ä¿¡å·æœªè¿æ¥ï¼Œé€»è¾‘æ°¸è¿œä¸æ‰§è¡Œ

---

## ğŸ¯ å®é™…å·¥ä½œæµç¨‹

### ç†æƒ³æµç¨‹
```
1. ä¿¡å·è¾“å…¥ â†’ ADCé‡‡æ ·
2. å‚æ•°æµ‹é‡æ¨¡å— â†’ è¾“å‡º ch1_freq, ch1_amplitude ç­‰
3. æ ¼å¼è½¬æ¢ â†’ signal_freq (32ä½Hz), signal_amplitude ç­‰
4. auto_test æ¨¡å— â†’ åˆ¤æ–­æ˜¯å¦åœ¨é˜ˆå€¼èŒƒå›´å†…
5. LEDè¾“å‡º â†’ æ˜¾ç¤ºæµ‹è¯•ç»“æœ
```

### å½“å‰æµç¨‹ï¼ˆæœ‰é—®é¢˜ï¼‰
```
1. ä¿¡å·è¾“å…¥ â†’ ADCé‡‡æ · âœ…
2. å‚æ•°æµ‹é‡æ¨¡å— â†’ è¾“å‡º ch1_freq, ch1_amplitude ç­‰ âœ…
3. æ ¼å¼è½¬æ¢ â†’ âŒ ä¸å­˜åœ¨ï¼
4. auto_test æ¨¡å— â†’ âŒ è¾“å…¥æ‚¬ç©ºï¼Œparam_valid=0
5. LEDè¾“å‡º â†’ âŒ æ°¸è¿œæ˜¾ç¤ºä¸åˆæ ¼
```

---

## ğŸ” è¿›ä¸€æ­¥æ£€æŸ¥

### æ£€æŸ¥1ï¼šparam_valid åœ¨ signal_parameter_measure ä¸­
è®©æˆ‘æ£€æŸ¥ `signal_parameter_measure.v` æ˜¯å¦è¾“å‡º `param_valid` æˆ–ç±»ä¼¼ä¿¡å·...

**ç»“æœ**ï¼šæœªæ‰¾åˆ° `param_valid` è¾“å‡ºã€‚

**å¯èƒ½çš„æ›¿ä»£ä¿¡å·**ï¼š
- `measure_done`ï¼šæµ‹é‡å®Œæˆæ ‡å¿—ï¼ˆå¯èƒ½å­˜åœ¨ï¼‰
- æˆ–ç›´æ¥ä½¿ç”¨ `1'b1`ï¼ˆå‚æ•°æŒç»­æœ‰æ•ˆï¼‰

---

### æ£€æŸ¥2ï¼šLEDè¾“å‡ºæ˜ å°„
```verilog
// auto_test.v Line 660-668
test_result[0] <= freq_pass;        // é¢‘ç‡åˆæ ¼æŒ‡ç¤º
test_result[1] <= amp_pass;         // å¹…åº¦åˆæ ¼æŒ‡ç¤º
test_result[2] <= duty_pass;        // å ç©ºæ¯”åˆæ ¼æŒ‡ç¤º
test_result[3] <= thd_pass;         // THDåˆæ ¼æŒ‡ç¤º
test_result[4] <= phase_pass;       // ç›¸ä½å·®åˆæ ¼æŒ‡ç¤ºï¼ˆé»˜è®¤é€šè¿‡ï¼‰
test_result[5] <= all_pass;         // ç»¼åˆåˆæ ¼æŒ‡ç¤ºï¼ˆé‡è¦ï¼‰
test_result[6] <= blink_1hz && test_enable;  // æµ‹è¯•è¿è¡Œé—ªçƒ
test_result[7] <= test_enable;      // æµ‹è¯•æ¨¡å¼æ¿€æ´»
```

**LEDæ˜ å°„**ï¼š
- LED[0-4]ï¼šå„å‚æ•°å•ç‹¬æŒ‡ç¤º
- **LED[5]**ï¼šç»¼åˆç»“æœï¼ˆå…¨éƒ¨åˆæ ¼æ—¶ç‚¹äº®ï¼‰â­æœ€é‡è¦
- LED[6]ï¼š1Hzé—ªçƒï¼ˆæµ‹è¯•è¿è¡Œä¸­ï¼‰
- LED[7]ï¼šæµ‹è¯•æ¨¡å¼æ¿€æ´»

---

## ğŸ› ï¸ ä¿®å¤ä»£ç 

### å®Œæ•´ä¿®å¤æ–¹æ¡ˆï¼ˆæ’å…¥åˆ° signal_analyzer_top.vï¼‰

**ä½ç½®**ï¼šLine 1710ï¼ˆ`auto_test` å®ä¾‹åŒ–ä¹‹å‰ï¼‰

```verilog
//=============================================================================
// 9.6 è‡ªåŠ¨æµ‹è¯•å‚æ•°æ ¼å¼è½¬æ¢
//=============================================================================
// å°† CH1 å‚æ•°è½¬æ¢ä¸º auto_test æ¨¡å—éœ€è¦çš„æ ¼å¼

// 1. é¢‘ç‡è½¬æ¢ï¼š16ä½+å•ä½æ ‡å¿— â†’ 32ä½Hzå€¼
reg [31:0] signal_freq;
always @(*) begin
    if (ch1_freq_is_mhz)
        signal_freq = {16'd0, ch1_freq} * 32'd1000000;  // MHz â†’ Hz
    else if (ch1_freq_is_khz)
        signal_freq = {16'd0, ch1_freq} * 32'd1000;     // kHz â†’ Hz
    else
        signal_freq = {16'd0, ch1_freq};                // Hz
end

// 2. å…¶ä»–å‚æ•°ç›´æ¥æ˜ å°„ï¼ˆæ ¼å¼å·²åŒ¹é…ï¼‰
wire [15:0] signal_amplitude = ch1_amplitude;
wire [15:0] signal_duty      = ch1_duty;
wire [15:0] signal_thd       = ch1_thd;

// 3. å‚æ•°æœ‰æ•ˆæ ‡å¿—ï¼šæŒç»­æœ‰æ•ˆï¼ˆå‚æ•°å®æ—¶æ›´æ–°ï¼‰
// æ³¨ï¼šå¦‚æœéœ€è¦æ›´ç²¾ç¡®çš„æœ‰æ•ˆæ ‡å¿—ï¼Œå¯ä½¿ç”¨ measure_done ä¿¡å·
wire param_valid = 1'b1;

// BCDæ ¼å¼è¾“å‡ºçº¿å®šä¹‰ä¿æŒä¸å˜...
```

---

## ğŸ“‹ éªŒè¯æ­¥éª¤

ä¿®å¤åéœ€è¦éªŒè¯ï¼š

### 1. ç¼–è¯‘æ£€æŸ¥
```bash
# ç»¼åˆæ—¶æ£€æŸ¥
- æ—  "signal not defined" è­¦å‘Š
- æ—  "floating signal" è­¦å‘Š
```

### 2. ä»¿çœŸéªŒè¯
```verilog
// æµ‹è¯•åœºæ™¯1ï¼š100kHz, 3V, 60%, 10% THDï¼ˆåº”è¯¥åˆæ ¼ï¼‰
signal_freq = 32'd100000;
signal_amplitude = 16'd3000;
signal_duty = 16'd600;
signal_thd = 16'd100;
// é¢„æœŸï¼šall_pass = 1

// æµ‹è¯•åœºæ™¯2ï¼š90kHzï¼ˆè¶…å‡ºèŒƒå›´ï¼Œåº”è¯¥ä¸åˆæ ¼ï¼‰
signal_freq = 32'd90000;
// é¢„æœŸï¼šfreq_pass = 0, all_pass = 0
```

### 3. ç¡¬ä»¶æµ‹è¯•
1. è¾“å…¥100kHz, 3V, 60%å ç©ºæ¯”æ–¹æ³¢
2. å¯ç”¨è‡ªåŠ¨æµ‹è¯•æ¨¡å¼
3. è§‚å¯ŸLED[5]ï¼ˆç»¼åˆç»“æœï¼‰æ˜¯å¦ç‚¹äº®
4. è°ƒæ•´å‚æ•°ï¼Œè§‚å¯ŸLEDå˜åŒ–

---

## ğŸ“Š é—®é¢˜ä¸¥é‡ç¨‹åº¦

| é—®é¢˜ | ä¸¥é‡ç¨‹åº¦ | å½±å“ | ä¿®å¤éš¾åº¦ |
|------|---------|------|---------|
| è¾“å…¥ä¿¡å·æœªå®šä¹‰ | ğŸ”´ ä¸¥é‡ | è‡ªåŠ¨æµ‹è¯•å®Œå…¨ä¸å·¥ä½œ | â­ ç®€å• |
| é¢‘ç‡æ ¼å¼ä¸åŒ¹é… | ğŸŸ¡ ä¸­ç­‰ | é¢‘ç‡åˆ¤æ–­é”™è¯¯ | â­â­ ä¸­ç­‰ |
| param_validæœªå®šä¹‰ | ğŸŸ¡ ä¸­ç­‰ | æµ‹è¯•é€»è¾‘ä¸æ‰§è¡Œ | â­ ç®€å• |

---

## ğŸ¯ æ€»ç»“

### å½“å‰çŠ¶æ€
- âŒ **è‡ªåŠ¨æµ‹è¯•æ¨¡å—æ— æ³•å·¥ä½œ**
- åŸå› ï¼šè¾“å…¥ä¿¡å·æœªæ­£ç¡®è¿æ¥
- è¡¨ç°ï¼šLEDæ°¸è¿œæ˜¾ç¤ºæµ‹è¯•å¤±è´¥

### éœ€è¦ä¿®å¤
1. âœ… æ·»åŠ ä¿¡å·æ ¼å¼è½¬æ¢é€»è¾‘ï¼ˆ10è¡Œä»£ç ï¼‰
2. âœ… è¿æ¥ `signal_freq/amplitude/duty/thd`
3. âœ… å®šä¹‰ `param_valid = 1'b1`

### ä¿®å¤å
- âœ… è‡ªåŠ¨æµ‹è¯•æ­£å¸¸å·¥ä½œ
- âœ… LEDæ­£ç¡®æŒ‡ç¤ºæµ‹è¯•ç»“æœ
- âœ… HDMIæ˜¾ç¤ºæµ‹è¯•å‚æ•°å’Œç»“æœ

---

**æŠ¥å‘Šç”Ÿæˆ**ï¼š2025å¹´11æœˆ7æ—¥  
**ä¼˜å…ˆçº§**ï¼šğŸ”´ P0 - å¿…é¡»ç«‹å³ä¿®å¤  
**é¢„è®¡ä¿®å¤æ—¶é—´**ï¼š10åˆ†é’Ÿ
