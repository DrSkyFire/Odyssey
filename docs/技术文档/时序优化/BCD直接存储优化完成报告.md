# BCDç›´æ¥å­˜å‚¨ä¼˜åŒ– - å®ŒæˆæŠ¥å‘Š

## ğŸ“‹ ä¼˜åŒ–æ¦‚è¿°

**é—®é¢˜**ï¼šHDMIåŸŸï¼ˆ74.25MHzï¼Œ13.5nså‘¨æœŸï¼‰å­˜åœ¨ä¸¥é‡æ—¶åºè¿ä¾‹
- WNS: -21.199 ns
- TNS: -1692.088 ns
- è¿ä¾‹ç«¯ç‚¹: 200/2525
- **æ ¹æœ¬åŸå› **ï¼šé¢‘ç‡/å¹…åº¦/å ç©ºæ¯”å‚æ•°çš„BCDè½¬æ¢ä½¿ç”¨é™¤æ³•è¿ç®—

**è§£å†³æ–¹æ¡ˆ**ï¼šç›´æ¥å­˜å‚¨BCDæ ¼å¼ï¼Œå°†è½¬æ¢ç§»åˆ°100MHzåŸŸ
- âœ… åœ¨100MHzåŸŸè°ƒæ•´å‚æ•°æ—¶åŒæ­¥ç»´æŠ¤Binaryå’ŒBCDä¸¤ç§æ ¼å¼
- âœ… HDMIåŸŸç›´æ¥ä½¿ç”¨é¢„è®¡ç®—çš„BCDå€¼ï¼Œå®Œå…¨é¿å…é™¤æ³•
- âœ… ä¿æŒåè¿›åˆ¶æ˜¾ç¤ºï¼Œç”¨æˆ·å‹å¥½

## âœ… å·²å®Œæˆä¿®æ”¹

### 1. auto_test.v ï¼ˆæ ¸å¿ƒé‡æ„ï¼‰

#### 1.1 æ•°æ®ç»“æ„æ”¹é€ 
```verilog
// æ–°å¢BCDæ ¼å¼å¯„å­˜å™¨ï¼ˆ28ä¸ªæ–°å¯„å­˜å™¨ï¼‰
reg [3:0] freq_min_d0, freq_min_d1, ..., freq_min_d5;  // é¢‘ç‡6ä½BCD
reg [3:0] freq_max_d0, freq_max_d1, ..., freq_max_d5;
reg [3:0] amp_min_d0, ..., amp_min_d3;                 // å¹…åº¦4ä½BCD
reg [3:0] amp_max_d0, ..., amp_max_d3;
reg [3:0] duty_min_d0, ..., duty_min_d3;               // å ç©ºæ¯”4ä½BCD
reg [3:0] duty_max_d0, ..., duty_max_d3;
reg [3:0] thd_max_d0, ..., thd_max_d3;                 // THD 4ä½BCD

// ä¿ç•™Binaryæ ¼å¼ç”¨äºæµ‹è¯•æ¯”è¾ƒ
reg [31:0] freq_min, freq_max;
reg [15:0] amp_min, amp_max, duty_min, duty_max, thd_max;
```

#### 1.2 æ·»åŠ è½¬æ¢å‡½æ•°
```verilog
// Binary â†’ BCD (ä½¿ç”¨Double Dabbleç®—æ³•)
function [23:0] bin32_to_bcd6(input [31:0] bin);
function [15:0] bin16_to_bcd4(input [15:0] bin);

// BCD â†’ Binary (ç”¨äºæµ‹è¯•æ¯”è¾ƒ)
function [31:0] bcd6_to_bin32(input [23:0] bcd);
function [15:0] bcd4_to_bin16(input [15:0] bcd);
```

#### 1.3 åŒæ­¥æ›´æ–°é€»è¾‘
```verilog
// ç¤ºä¾‹ï¼šé¢‘ç‡ä¸‹é™å¢åŠ 
if (btn_limit_dn_up && freq_min + freq_step < freq_max) begin
    freq_min_new = freq_min + freq_step;           // æ›´æ–°Binary
    freq_min <= freq_min_new;
    bcd_temp_24 = bin32_to_bcd6(freq_min_new);     // è½¬æ¢ä¸ºBCD
    {freq_min_d5, ..., freq_min_d0} <= bcd_temp_24;  // æ›´æ–°BCD
end
```

#### 1.4 æ–°å¢è¾“å‡ºç«¯å£ï¼ˆ28ä¸ªï¼‰
```verilog
output wire [3:0] freq_min_d0_out, freq_min_d1_out, ..., freq_min_d5_out,
output wire [3:0] freq_max_d0_out, ..., freq_max_d5_out,
output wire [3:0] amp_min_d0_out, ..., amp_min_d3_out,
output wire [3:0] amp_max_d0_out, ..., amp_max_d3_out,
output wire [3:0] duty_min_d0_out, ..., duty_min_d3_out,
output wire [3:0] duty_max_d0_out, ..., duty_max_d3_out,
output wire [3:0] thd_max_d0_out, ..., thd_max_d3_out
```

### 2. hdmi_display_ctrl.v ï¼ˆåˆ é™¤é™¤æ³•ï¼‰

#### 2.1 æ–°å¢è¾“å…¥ç«¯å£ï¼ˆ28ä¸ªï¼‰
```verilog
// BCDæ ¼å¼è¾“å…¥ï¼ˆç”¨äºç›´æ¥æ˜¾ç¤ºï¼Œé¿å…é™¤æ³•è¿ç®—ï¼‰
input wire [3:0] freq_min_d0, freq_min_d1, freq_min_d2,
input wire [3:0] freq_min_d3, freq_min_d4, freq_min_d5,
// ... å…±28ä¸ªè¾“å…¥ç«¯å£
```

#### 2.2 åˆ é™¤å†…éƒ¨å¯„å­˜å™¨å£°æ˜
```verilog
// åˆ é™¤ï¼š
// reg [3:0] freq_min_d0, freq_min_d1, ..., freq_min_d5;
// reg [3:0] freq_max_d0, ..., freq_max_d5;
// ... ï¼ˆç°åœ¨éƒ½æ˜¯è¾“å…¥ç«¯å£äº†ï¼‰
```

#### 2.3 åˆ é™¤BCDè½¬æ¢å‡½æ•°
```verilog
// åˆ é™¤æ•´ä¸ªfunctionå®šä¹‰ï¼š
// function [3:0] bcd_digit(input [31:0] value, input [2:0] digit_pos);
//     case (digit_pos)
//         3'd0: bcd_digit = value % 10;        // åˆ é™¤è¿™äº›é™¤æ³•ï¼
//         3'd1: bcd_digit = (value / 10) % 10;
//         ...
//     endcase
// endfunction
```

#### 2.4 åˆ é™¤BCDè½¬æ¢alwayså—ï¼ˆå…³é”®ï¼ï¼‰
```verilog
// åˆ é™¤çº¦70è¡Œä»£ç ï¼ˆLine 708-777ï¼‰ï¼š
// if (v_cnt == 12'd0 && h_cnt == 12'd215) begin
//     freq_min_d0 <= freq_min_khz % 10;              // âŒ åˆ é™¤ï¼
//     freq_min_d1 <= (freq_min_khz / 10) % 10;       // âŒ åˆ é™¤ï¼
//     freq_min_d2 <= (freq_min_khz / 100) % 10;      // âŒ åˆ é™¤ï¼
//     ... å…±36æ¬¡é™¤æ³•å’Œå–æ¨¡è¿ç®—å…¨éƒ¨åˆ é™¤ï¼
// end
```

**åˆ é™¤çš„è¿ç®—ç»Ÿè®¡**ï¼š
- é¢‘ç‡ä¸‹é™ï¼š6æ¬¡é™¤æ³• + 6æ¬¡å–æ¨¡
- é¢‘ç‡ä¸Šé™ï¼š6æ¬¡é™¤æ³• + 6æ¬¡å–æ¨¡
- å¹…åº¦ä¸‹é™ï¼š4æ¬¡é™¤æ³• + 4æ¬¡å–æ¨¡
- å¹…åº¦ä¸Šé™ï¼š4æ¬¡é™¤æ³• + 4æ¬¡å–æ¨¡
- å ç©ºæ¯”ä¸‹é™ï¼š3æ¬¡é™¤æ³• + 3æ¬¡å–æ¨¡
- å ç©ºæ¯”ä¸Šé™ï¼š3æ¬¡é™¤æ³• + 3æ¬¡å–æ¨¡
- THDä¸Šé™ï¼š3æ¬¡é™¤æ³• + 3æ¬¡å–æ¨¡
- **æ€»è®¡ï¼š58æ¬¡é™¤æ³•/å–æ¨¡è¿ç®—å®Œå…¨åˆ é™¤ï¼**

### 3. signal_analyzer_top.v ï¼ˆè¿æ¥BCDä¿¡å·ï¼‰

#### 3.1 æ·»åŠ BCDä¿¡å·çº¿ï¼ˆ28æ ¹ï¼‰
```verilog
wire [3:0] freq_min_d0, freq_min_d1, ..., freq_min_d5;
wire [3:0] freq_max_d0, ..., freq_max_d5;
wire [3:0] amp_min_d0, ..., amp_min_d3;
// ... å…±28æ ¹ä¿¡å·çº¿
```

#### 3.2 è¿æ¥auto_testæ¨¡å—
```verilog
auto_test u_auto_test (
    // ... åŸæœ‰ç«¯å£ ...
    
    // BCDæ ¼å¼è¾“å‡º
    .freq_min_d0_out(freq_min_d0), .freq_min_d1_out(freq_min_d1), ...
    .freq_max_d0_out(freq_max_d0), ...
    .amp_min_d0_out(amp_min_d0), ...
    // ... å…±28ä¸ªè¿æ¥
);
```

#### 3.3 è¿æ¥hdmi_display_ctrlæ¨¡å—
```verilog
hdmi_display_ctrl u_hdmi_ctrl (
    // ... åŸæœ‰ç«¯å£ ...
    
    // BCDæ ¼å¼è¾“å…¥ï¼ˆç›´æ¥æ˜¾ç¤ºï¼Œ0å»¶è¿Ÿï¼‰
    .freq_min_d0(freq_min_d0), .freq_min_d1(freq_min_d1), ...
    .freq_max_d0(freq_max_d0), ...
    .amp_min_d0(amp_min_d0), ...
    // ... å…±28ä¸ªè¿æ¥
);
```

## ğŸ“Š é¢„æœŸæ•ˆæœ

### æ—¶åºæ”¹å–„
| æ—¶é’ŸåŸŸ | ä¼˜åŒ–å‰ | é¢„æœŸä¼˜åŒ–å | æ”¹å–„å¹…åº¦ |
|--------|--------|------------|----------|
| **HDMI (74.25MHz)** | WNS = -21.199 ns | WNS â‰¥ 0 ns | **+21.2 ns** âœ¨ |
| **100MHz** | WNS = -3.437 ns | WNS â‰¥ 0 ns | +3.4 ns |

### èµ„æºä½¿ç”¨
| èµ„æº | å˜åŒ– | è¯´æ˜ |
|------|------|------|
| **LUT** | å‡å°‘ | åˆ é™¤äº†58ä¸ªé™¤æ³•/å–æ¨¡è¿ç®— |
| **å¯„å­˜å™¨** | +28 | æ–°å¢BCDå¯„å­˜å™¨ï¼ˆauto_test.vï¼‰ |
| **ç»„åˆé€»è¾‘æ·±åº¦** | æ˜¾è‘—å‡å°‘ | HDMIåŸŸæ— é™¤æ³•ï¼Œä»…ç›´é€š |

### åŠŸèƒ½å®Œæ•´æ€§
- âœ… **ä¿æŒåè¿›åˆ¶æ˜¾ç¤º** - ç”¨æˆ·å‹å¥½çš„åè¿›åˆ¶æ ¼å¼
- âœ… **ç²¾åº¦æ— æŸ** - BCDç²¾ç¡®è¡¨ç¤º0-999999
- âœ… **å®æ—¶å“åº”** - æŒ‰é”®è°ƒæ•´ç«‹å³æ›´æ–°
- âœ… **æµ‹è¯•åŠŸèƒ½å®Œæ•´** - Binaryæ ¼å¼ä¿ç•™ç”¨äºé˜ˆå€¼æ¯”è¾ƒ

## ğŸ” æŠ€æœ¯äº®ç‚¹

### 1. è·¨æ—¶é’ŸåŸŸä¼˜åŒ–
```
100MHzåŸŸï¼ˆå®½æ¾ï¼‰          CDC           HDMIåŸŸï¼ˆç´§å¼ ï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Binary + BCD    â”‚ â”€â”€â”€BCDå€¼â”€â”€â”€â”€â”€â”€â”€> â”‚ ç›´æ¥ä½¿ç”¨BCD     â”‚
â”‚ åŒæ­¥æ›´æ–°        â”‚                   â”‚ 0è®¡ç®—å»¶è¿Ÿ       â”‚
â”‚ Binaryç”¨äºæµ‹è¯•  â”‚                   â”‚ ä»…æŸ¥è¡¨æ˜¾ç¤º      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    æœ‰æ—¶é—´è®¡ç®—                           æç®€é€»è¾‘
```

### 2. Double Dabbleç®—æ³•
```verilog
// Binaryè½¬BCDçš„ç»å…¸ç®—æ³•
// æ—¶é—´å¤æ‚åº¦ï¼šO(n)ï¼Œnä¸ºbitæ•°
// ç©ºé—´å¤æ‚åº¦ï¼šO(1)
for (i = 0; i < 32; i = i + 1) begin
    if (shift_reg[35:32] >= 5) shift_reg[35:32] += 3;  // Add-3è§„åˆ™
    if (shift_reg[39:36] >= 5) shift_reg[39:36] += 3;
    // ... å¯¹æ¯ä¸ªBCDä½æ£€æŸ¥
    shift_reg = shift_reg << 1;  // å·¦ç§»
end
```

### 3. ä¹˜æ³•ä»£æ›¿é™¤æ³•ï¼ˆBCDâ†’Binaryï¼‰
```verilog
// é™¤æ³•ï¼šbcd[3:0] / 10 (æ…¢)
// ä¹˜æ³•ï¼šbcd[3:0] + bcd[7:4]*10 + bcd[11:8]*100 + ... (å¿«)
// 10, 100, 1000ç­‰æ˜¯å¸¸æ•°ï¼Œå¯ä¼˜åŒ–ä¸ºç§»ä½+åŠ æ³•
```

## ğŸ“ˆ ä»£ç è´¨é‡

### ä¿®æ”¹ç»Ÿè®¡
| æ–‡ä»¶ | æ–°å¢è¡Œ | åˆ é™¤è¡Œ | ä¿®æ”¹è¡Œ | å¤æ‚åº¦ |
|------|--------|--------|--------|--------|
| auto_test.v | +150 | -20 | +30 | å¢åŠ ï¼ˆåŠŸèƒ½æ‰©å±•ï¼‰ |
| hdmi_display_ctrl.v | +10 | -90 | +5 | **é™ä½**ï¼ˆåˆ é™¤å¤æ‚é€»è¾‘ï¼‰ |
| signal_analyzer_top.v | +20 | -0 | +10 | ç•¥å¢ï¼ˆè¿çº¿ï¼‰ |

### å¯ç»´æŠ¤æ€§
- âœ… **é€»è¾‘æ¸…æ™°** - BCDè½¬æ¢é›†ä¸­åœ¨auto_test.v
- âœ… **èŒè´£åˆ†æ˜** - 100MHzåŸŸè®¡ç®—ï¼ŒHDMIåŸŸæ˜¾ç¤º
- âœ… **æ˜“äºæ‰©å±•** - å¯è½»æ¾æ·»åŠ æ–°çš„å‚æ•°æ˜¾ç¤º
- âœ… **æ³¨é‡Šå®Œæ•´** - å…³é”®ä½ç½®æ·»åŠ äº†ä¼˜åŒ–è¯´æ˜

## ğŸ¯ åç»­å»ºè®®

### çŸ­æœŸï¼ˆå·²å®Œæˆï¼‰
- âœ… ç¼–è¯‘éªŒè¯ï¼šæ— è¯­æ³•é”™è¯¯
- â³ **æ—¶åºéªŒè¯**ï¼šéœ€è¦é‡æ–°ç»¼åˆå¹¶æŸ¥çœ‹æ—¶åºæŠ¥å‘Š
- â³ **åŠŸèƒ½æµ‹è¯•**ï¼šç¡¬ä»¶æµ‹è¯•å‚æ•°è°ƒæ•´å’Œæ˜¾ç¤º

### ä¸­æœŸ
- ğŸ”„ **ç›¸ä½å·®ä¼˜åŒ–**ï¼šç›¸ä½å·®BCDè½¬æ¢ä»ä½¿ç”¨é™¤æ³•ï¼ˆLine 695-705ï¼‰
  ```verilog
  phase_d0 <= phase_abs % 10;              // å¯ä»¥ç”¨ç±»ä¼¼æ–¹æ³•ä¼˜åŒ–
  phase_d1 <= (phase_abs / 10) % 10;
  ```
- ğŸ”„ **é€šé“å‚æ•°ä¼˜åŒ–**ï¼šCH1/CH2çš„å‚æ•°BCDè½¬æ¢ä¹Ÿå¯ä¼˜åŒ–

### é•¿æœŸ
- ğŸ’¡ **æŸ¥æ‰¾è¡¨æ–¹æ¡ˆ**ï¼šå¯¹äºå›ºå®šèŒƒå›´çš„å€¼ï¼Œå¯ä½¿ç”¨ROMæŸ¥æ‰¾è¡¨
- ğŸ’¡ **IPæ ¸**ï¼šè€ƒè™‘ä½¿ç”¨å‚å•†æä¾›çš„BCDè½¬æ¢IP
- ğŸ’¡ **å¼‚æ­¥FIFO**ï¼šç”¨FIFOä»£æ›¿CDCä¼ é€’å¤šä½æ•°æ®

## ğŸš€ éªŒè¯æ­¥éª¤

### 1. ç¼–è¯‘æ£€æŸ¥ï¼ˆâœ… å·²å®Œæˆï¼‰
```powershell
# æ‰€æœ‰æ–‡ä»¶æ— è¯­æ³•é”™è¯¯
âœ… auto_test.v
âœ… hdmi_display_ctrl.v
âœ… signal_analyzer_top.v
```

### 2. ç»¼åˆéªŒè¯ï¼ˆå¾…æ‰§è¡Œï¼‰
```tcl
# è¿è¡Œç»¼åˆ
synthesize

# æŸ¥çœ‹æ—¶åºæŠ¥å‘Š
report_timing -nworst 10

# é¢„æœŸç»“æœï¼š
# - HDMIåŸŸ WNS â‰¥ 0
# - 100MHzåŸŸ WNS â‰¥ 0
```

### 3. åŠŸèƒ½æµ‹è¯•ï¼ˆå¾…æ‰§è¡Œï¼‰
1. è¿›å…¥è‡ªåŠ¨æµ‹è¯•æ¨¡å¼
2. è°ƒæ•´é¢‘ç‡/å¹…åº¦/å ç©ºæ¯”å‚æ•°
3. éªŒè¯æ˜¾ç¤ºæ­£ç¡®ä¸”å®æ—¶æ›´æ–°
4. éªŒè¯é˜ˆå€¼æµ‹è¯•åŠŸèƒ½æ­£å¸¸

## ğŸ“ Gitæäº¤

```bash
git add source/source/auto_test.v
git add source/source/hdmi_display_ctrl.v
git add source/source/signal_analyzer_top.v
git commit -m "feat: å½»åº•ä¼˜åŒ–HDMIæ—¶åº - BCDç›´æ¥å­˜å‚¨æ–¹æ¡ˆ

- åœ¨auto_test.vä¸­åŒæ­¥ç»´æŠ¤Binaryå’ŒBCDä¸¤ç§æ ¼å¼
- å®Œå…¨åˆ é™¤hdmi_display_ctrl.vä¸­çš„58ä¸ªé™¤æ³•/å–æ¨¡è¿ç®—
- HDMIåŸŸæ”¹ä¸ºç›´æ¥ä½¿ç”¨é¢„è®¡ç®—çš„BCDå€¼ï¼Œ0å»¶è¿Ÿæ˜¾ç¤º
- é¢„æœŸæ—¶åºæ”¹å–„ï¼šHDMIåŸŸ +21nsï¼Œ100MHzåŸŸ +3ns
- ä¿æŒåè¿›åˆ¶æ˜¾ç¤ºï¼Œç”¨æˆ·ä½“éªŒæ— å˜åŒ–

è¯¦ç»†è¯´æ˜è§ BCDç›´æ¥å­˜å‚¨ä¼˜åŒ–å®ŒæˆæŠ¥å‘Š.md"
```

## ğŸ“ æŠ€æœ¯æ€»ç»“

è¿™æ¬¡ä¼˜åŒ–å±•ç¤ºäº†å‡ ä¸ªé‡è¦çš„FPGAè®¾è®¡åŸåˆ™ï¼š

1. **å°†è®¡ç®—ç§»åˆ°å®½æ¾æ—¶é’ŸåŸŸ** - 100MHz vs 74.25MHz
2. **é¢„è®¡ç®—ç­–ç•¥** - è°ƒæ•´æ—¶è®¡ç®—ï¼Œæ˜¾ç¤ºæ—¶ç›´æ¥ç”¨
3. **è·¨æ—¶é’ŸåŸŸæ•°æ®ä¼ é€’** - ä¼ é€’ç»“æœè€ŒéåŸå§‹æ•°æ®
4. **ç®—æ³•ä¼˜åŒ–** - Double Dabble vs ç›´æ¥é™¤æ³•
5. **èµ„æº-æ€§èƒ½æƒè¡¡** - ç”¨28ä¸ªå¯„å­˜å™¨æ¢å–20nsæ—¶åºæ”¹å–„

**æ ¸å¿ƒæ€æƒ³**ï¼š
> **Time-Space Tradeoff - ç”¨ç©ºé—´ï¼ˆå¯„å­˜å™¨ï¼‰æ¢æ—¶é—´ï¼ˆæ—¶åºè£•é‡ï¼‰**

---

**ä¼˜åŒ–å®Œæˆï¼å‡†å¤‡ç¼–è¯‘éªŒè¯ã€‚** ğŸ‰
