# HDMI Character ROM Encoding Reference

## 字符编码映射表 (Character Code Mapping)

### 数字 (Digits)
| 字符 | 编码 | 说明 |
|-----|------|------|
| '0' | 0    | 数字零 |
| '1' | 1    | 数字一 |
| '2' | 2    | 数字二 |
| '3' | 3    | 数字三 |
| '4' | 4    | 数字四 |
| '5' | 5    | 数字五 |
| '6' | 6    | 数字六 |
| '7' | 7    | 数字七 |
| '8' | 8    | 数字八 |
| '9' | 9    | 数字九 |

### 标点符号 (Punctuation)
| 字符 | 编码 | 说明 |
|-----|------|------|
| '.' | 10   | 小数点 |
| ':' | 11   | 冒号(旧) |
| ':' | 44   | 冒号(新) ✅ HDMI显示使用 |
| '%' | 12   | 百分号(旧) |
| '%' | 37   | 百分号(新) ✅ HDMI显示使用 |

### 大写字母 (Uppercase Letters)
| 字符 | 编码 | 说明 | 用途 |
|-----|------|------|------|
| 'C' | 12   | 字母C | "CH1", "CH2" |
| 'F' | 16   | 字母F | "Freq" |
| 'H' | 13   | 字母H(旧) | - |
| 'H' | 18   | 字母H(新) ✅ | "CH1", "Hz" |
| 'N' | 23   | 字母N | "Nois"(Noise) |
| 'S' | 29   | 字母S | "Sine", "Squr", "Saw" |
| 'T' | 30   | 字母T | "Tria"(Triangle) |
| 'U' | 32   | 字母U | "Unkn"(Unknown) |

### 小写字母 (Lowercase Letters)
| 字符 | 编码 | 说明 | 用途 |
|-----|------|------|------|
| 'a' | 17   | 字母a | "Saw", "Tria" |
| 'e' | 15   | 字母e | "Sine" |
| 'i' | 19   | 字母i | "Sine", "Tria", "Nois" |
| 'k' | 21   | 字母k | "Unkn" |
| 'n' | 24   | 字母n | "Sine", "Unkn" |
| 'o' | 25   | 字母o | "Nois" |
| 'q' | 27   | 字母q | "Squr"(Square) |
| 'r' | 28   | 字母r | "Squr", "Tria" |
| 'u' | 31   | 字母u | "Squr", "Unkn" |
| 'w' | 33   | 字母w | "Saw" |
| 'z' | 14   | 字母z | "Hz" |

### 特殊字符 (Special Characters)
| 字符 | 编码 | 说明 |
|-----|------|------|
| (空格) | 0 | 空白字符 |

---

## AI 波形类型名称映射 (AI Waveform Type Names)

### 显示格式
```
CH1: Sine 95%
CH2: Squr 88%
```

### 波形类型编码与名称
| 类型编码 | 波形名称 | 简化显示 | 字符编码序列 |
|---------|---------|---------|-------------|
| 3'd0    | Unknown | Unkn    | U(32) + n(24) + k(21) + n(24) |
| 3'd1    | Sine    | Sine    | S(29) + i(19) + n(24) + e(15) |
| 3'd2    | Square  | Squr    | S(29) + q(27) + u(31) + r(28) |
| 3'd3    | Triangle| Tria    | T(30) + r(28) + i(19) + a(17) |
| 3'd4    | Sawtooth| Saw     | S(29) + a(17) + w(33) + (空格) |
| 3'd5    | Noise   | NoisS   | N(23) + o(25) + i(19) + S(29) ⚠️临时 |

⚠️ **注意**: Noise 的最后一个字符应该是小写 's'，但当前 ROM 中没有小写 's' (编码26/35等)，临时使用大写 'S'(29)。建议后续添加小写 's' 字符。

---

## HDMI 显示行定义 (Display Lines)

### 参数区域 (Y: 870-1065)
| 行号 | Y坐标范围 | 内容 | 字符编码使用 |
|-----|----------|------|-------------|
| 1 | 870-909  | "Freq: XXXXX Hz" | F(16), :(44), 数字(0-9), H(18), z(14) |
| 2 | 915-954  | "Amp: XXXX"      | (未详细记录) |
| 3 | 960-999  | "Phase: XXX °"   | (未详细记录) |
| 4 | 1005-1044| "Duty: XX %"     | (未详细记录) |
| 5 | 1050-1089| (预留)           | - |
| 6 | 1095-1134| "CH1: Sine 95%"  | C(12), H(18), 1(1), :(44), 波形名称, %(37) |
| 7 | 1140-1179| "CH2: Squr 88%"  | C(12), H(18), 2(2), :(44), 波形名称, %(37) |

⚠️ **注意**: 所有参数行的 `char_row` 计算必须使用相对偏移:
```verilog
char_row = pixel_y_d1 - PARAM_Y_START - (行偏移);
```

---

## 字符 ROM 结构 (Character ROM Structure)

### 文件位置
- **模块文件**: `source/source/char_rom_16x32.v`
- **点阵大小**: 16×32 像素
- **输入接口**: 
  - `char_code[5:0]` - 字符编码 (0-63)
  - `row[4:0]` - 行号 (0-31)
- **输出接口**:
  - `pixel_row[15:0]` - 16位像素行数据

### 点阵格式
每个字符定义为 32 个 case 分支，每行 16 位二进制数据:
```verilog
6'dXX: begin
    case (row)
        5'd0:  pixel_row = 16'b0000000000000000; // 第1行
        5'd1:  pixel_row = 16'b0001111111110000; // 第2行
        ...
        5'd31: pixel_row = 16'b0000000000000000; // 第32行
    endcase
end
```

---

## 待办事项 (TODO)

### 缺失字符
- [ ] 添加小写 's' (建议编码: 34 或 26)
- [ ] 添加度数符号 '°' (建议编码: 35 或 38)
- [ ] 统一标点符号编码 (避免重复定义)

### 优化建议
1. 清理重复字符编码 ('%' 有12和37两个编码)
2. 清理重复字符编码 (':' 有11和44两个编码)
3. 添加完整的字母表 (a-z, A-Z)
4. 考虑使用 ASCII 码作为编码基准

---

## 修改历史 (Change Log)

### 2024-XX-XX (最近修改)
- ✅ 修正 char_row 计算错误 (行1: pixel_y_d1[4:0] → pixel_y_d1 - PARAM_Y_START)
- ✅ 添加 15 个新字符: C, F, H, N, S, T, U, a, e, i, k, n, o, q, r, u, w
- ✅ 修正 'F'(Freq) 编码: 13 → 16
- ✅ 修正 'H'(Hz) 编码: 13 → 18
- ✅ 修正 ':'(冒号) 编码: 11 → 44
- ✅ 修正 '%'(百分号) 编码: 12 → 37
- ✅ 修正 'N'(Noise) 编码: 24 → 23
- ✅ 修正 'U'(Unknown) 编码: 31 → 32
- ✅ 修正 "Squr" 第4字符: 'a' → 'r' (Square简写应为Squr)
- ⚠️ 临时方案: Noise 显示为 "NoisS" (缺少小写s)

### 问题修复
**原始问题**: "00Hz 显示为上下颠倒且只有一半"
- **根本原因**: 第1行的 char_row 使用错误计算方法
- **解决方案**: 改为相对偏移计算
- **验证**: 其他6行都使用正确的相对偏移计算

---

*文档生成时间: 自动*
*维护者: 请在修改 char_rom_16x32.v 或 hdmi_display_ctrl.v 时同步更新此文档*
