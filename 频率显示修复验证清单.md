# 频率显示修复验证测试清单

**测试日期**: _____________  
**测试人员**: _____________  
**固件版本**: _____________  

---

## 测试设备

- [ ] FPGA开发板（紫光同创Odyssey）
- [ ] 函数发生器（精度 ≥ 0.01%）
- [ ] 示波器（用于校准）
- [ ] HDMI显示器（1280×720分辨率）
- [ ] BNC连接线

---

## 快速验证测试（15分钟）

### 测试1: 100kHz关键点 🔴 最重要

**目的**: 验证Bug #1修复效果

| 步骤 | 操作 | 预期结果 | 实际结果 | 通过/失败 |
|------|------|----------|----------|-----------|
| 1 | 函数发生器输出100.00kHz, 3.3Vpp正弦波 | - | - | - |
| 2 | 连接到CH1输入 | - | - | - |
| 3 | 观察HDMI显示频率值 | **100 kHz** 或 **100.0 kHz** | 100.00kHz | ☐ |
| 4 | 允许误差范围 | 99.5 - 100.5 kHz | 通过 | ☐ |
| 5 | 观察显示稳定性（10秒） | 无跳动或<±1 kHz | 无跳动 | ☐ |

**判定**: 
- ✅ 通过 = 显示值在99.5-100.5 kHz范围内
- ❌ 失败 = 显示10000 kHz或其他错误值

---

### 测试2: 单位切换边界

**目的**: 验证Hz/kHz自动切换

| 测试点 | 输入频率 | 预期单位 | 预期显示值 | 实际显示 | 通过 |
|--------|----------|----------|------------|----------|------|
| 2.1 | 99.5 kHz | Hz | 99500 Hz | 33971Hz | ☐ |
| 2.2 | 99.9 kHz | Hz | 99900 Hz | 34366Hz | ☐ |
| 2.3 | 100.0 kHz | **kHz** | **100 kHz** | _______ | ☐ |
| 2.4 | 100.1 kHz | kHz | 100 kHz | _______ | ☐ |
| 2.5 | 105 kHz | kHz | 105 kHz | _______ | ☐ |

**注意**: 
- 切换点在100kHz（freq_temp=10000）
- 可能有±1次过零的误差（即±10Hz）

---

### 测试3: 常用频率点快速扫描

| 频率 | 预期显示 | 实际显示 | 误差 | 通过 |
|------|----------|----------|------|------|
| 1 kHz | 1000 Hz 或 1.00 kHz | _______ | ___% | ☐ |
| 10 kHz | 10000 Hz 或 10.0 kHz | _______ | ___% | ☐ |
| 50 kHz | 50000 Hz | _______ | ___% | ☐ |
| 500 kHz | 500 kHz | _______ | ___% | ☐ |
| 1 MHz | 1000 kHz 或 1.0 MHz | _______ | ___% | ☐ |

**判定**: 所有点误差 < 1%

---

## 完整验证测试（1小时）

### 测试4: 低频范围（10Hz - 1kHz）

| 频率 | 预期 | 实际 | 误差 | 备注 |
|------|------|------|------|------|
| 10 Hz | 10 Hz | ____ | ___% | 过零检测最低点 |
| 50 Hz | 50 Hz | ____ | ___% | 工频 |
| 100 Hz | 100 Hz | ____ | ___% | - |
| 500 Hz | 500 Hz | ____ | ___% | - |
| 1 kHz | 1000 Hz | ____ | ___% | - |

**允许误差**: < 1% (时域测量限制)

---

### 测试5: 中频范围（1kHz - 100kHz）

| 频率 | 预期 | 实际 | 误差 | 备注 |
|------|------|------|------|------|
| 5 kHz | 5000 Hz | ____ | ___% | - |
| 10 kHz | 10000 Hz | ____ | ___% | - |
| 20 kHz | 20000 Hz | ____ | ___% | 可听范围上限 |
| 50 kHz | 50000 Hz | ____ | ___% | - |
| 99 kHz | 99000 Hz | ____ | ___% | 切换点前 |

**允许误差**: < 0.5%

---

### 测试6: 高频范围（100kHz - 10MHz）

| 频率 | 预期 | 实际 | 误差 | 备注 |
|------|------|------|------|------|
| 100 kHz | 100 kHz | ____ | ___% | **关键点** |
| 200 kHz | 200 kHz | ____ | ___% | - |
| 500 kHz | 500 kHz | ____ | ___% | - |
| 1 MHz | 1000 kHz | ____ | ___% | - |
| 2 MHz | 2000 kHz | ____ | ___% | - |
| 5 MHz | 5000 kHz | ____ | ___% | - |
| 10 MHz | 10000 kHz | ____ | ___% | - |

**允许误差**: 
- 当前（仅时域）: < 1%
- 启用FFT后: < 0.1%

---

### 测试7: 精度验证（1MHz基准）

**方法**: 使用1MHz标准信号，测量10次

| 次数 | 显示值(kHz) | 误差(Hz) | 误差率 |
|------|-------------|----------|--------|
| 1 | _______ | _______ | ___% |
| 2 | _______ | _______ | ___% |
| 3 | _______ | _______ | ___% |
| 4 | _______ | _______ | ___% |
| 5 | _______ | _______ | ___% |
| 6 | _______ | _______ | ___% |
| 7 | _______ | _______ | ___% |
| 8 | _______ | _______ | ___% |
| 9 | _______ | _______ | ___% |
| 10 | _______ | _______ | ___% |
| **平均** | _______ | _______ | ___% |
| **最大偏差** | _______ | _______ | ___% |

**判定标准**:
- ✅ 平均误差 < 0.5%
- ✅ 最大偏差 < 1%
- ⚠️ 如果误差 > 1%，需要启用FFT测量

---

### 测试8: 稳定性测试

**方法**: 持续输入100kHz信号，观察5分钟

| 时间 | 显示值 | 变化量 | 备注 |
|------|--------|--------|------|
| 0s | _______ kHz | - | 初始值 |
| 30s | _______ kHz | ±___ | - |
| 1min | _______ kHz | ±___ | - |
| 2min | _______ kHz | ±___ | - |
| 3min | _______ kHz | ±___ | - |
| 4min | _______ kHz | ±___ | - |
| 5min | _______ kHz | ±___ | 最终值 |

**判定**: 变化量 < ±2 kHz（±2%）

---

### 测试9: 波形类型测试

**目的**: 验证不同波形的频率测量准确性

| 波形类型 | 频率 | 预期 | 实际 | 误差 | 通过 |
|----------|------|------|------|------|------|
| 正弦波 | 100 kHz | 100 kHz | ____ | ___% | ☐ |
| 方波 | 100 kHz | 100 kHz | ____ | ___% | ☐ |
| 三角波 | 100 kHz | 100 kHz | ____ | ___% | ☐ |
| 锯齿波 | 100 kHz | 100 kHz | ____ | ___% | ☐ |

**判定**: 所有波形误差 < 1%

---

### 测试10: 幅度影响测试

**目的**: 验证幅度变化不影响频率测量

| 幅度(Vpp) | 频率 | 预期 | 实际 | 通过 |
|-----------|------|------|------|------|
| 0.1V | 100 kHz | 100 kHz | ____ | ☐ |
| 0.5V | 100 kHz | 100 kHz | ____ | ☐ |
| 1.0V | 100 kHz | 100 kHz | ____ | ☐ |
| 2.0V | 100 kHz | 100 kHz | ____ | ☐ |
| 3.3V | 100 kHz | 100 kHz | ____ | ☐ |

**判定**: 所有幅度显示一致（±1 kHz）

---

## 回归测试（其他功能）

### 测试11: 幅度测量（确认未影响）

| 输入 | 预期幅度 | 实际幅度 | 通过 |
|------|----------|----------|------|
| 1V, 100kHz | ~1000 mV | _______ | ☐ |
| 2V, 100kHz | ~2000 mV | _______ | ☐ |
| 3V, 100kHz | ~3000 mV | _______ | ☐ |

---

### 测试12: 占空比测量（确认未影响）

| 输入 | 预期占空比 | 实际占空比 | 通过 |
|------|------------|------------|------|
| 50%方波, 100kHz | 50.0% | _______ | ☐ |
| 25%方波, 100kHz | 25.0% | _______ | ☐ |
| 75%方波, 100kHz | 75.0% | _______ | ☐ |

---

## 边界条件测试

### 测试13: 极限频率

| 测试点 | 输入 | 预期行为 | 实际 | 通过 |
|--------|------|----------|------|------|
| 最低频率 | 10 Hz | 显示10 Hz | ____ | ☐ |
| 奈奎斯特频率 | 17.5 MHz | 显示17500 kHz | ____ | ☐ |
| 超出范围 | 20 MHz | 显示错误或饱和 | ____ | ☐ |

---

### 测试14: 无信号/噪声

| 测试点 | 输入 | 预期 | 实际 | 通过 |
|--------|------|------|------|------|
| 无信号 | 0V直流 | 0 Hz | ____ | ☐ |
| 白噪声 | <50mV | 不稳定/0 | ____ | ☐ |
| 微弱信号 | 10mV, 1kHz | 1000 Hz | ____ | ☐ |

---

## 已知问题验证

### 问题A: FFT测量禁用 ⚠️

- [ ] 确认当前仅使用时域过零检测
- [ ] 测量10MHz信号，记录误差：_______%
- [ ] 如果误差 > 0.1%，建议启用FFT

### 问题B: 显示刷新率 ℹ️

- [ ] 快速扫频（1-100kHz，1秒内），观察响应
- [ ] 延迟时间：约______秒
- [ ] 如果 > 1秒，考虑优化滤波器

---

## 测试总结

### 通过标准
- ✅ 测试1-3（快速验证）全部通过
- ✅ 测试4-10（完整验证）≥90%通过
- ✅ 关键点100kHz误差 < 1%

### 实际结果

| 项目 | 通过数 | 总数 | 通过率 |
|------|--------|------|--------|
| 快速验证 | __/__ | 15 | ___% |
| 完整验证 | __/__ | 45 | ___% |
| 回归测试 | __/__ | 6 | ___% |
| 边界测试 | __/__ | 7 | ___% |
| **总计** | **__/__** | **73** | **___%** |

### 问题记录

**发现的新问题**:
1. ________________________________________________________________
2. ________________________________________________________________
3. ________________________________________________________________

**需要优化的点**:
1. ________________________________________________________________
2. ________________________________________________________________

### 最终结论

- [ ] ✅ **修复成功** - 100kHz显示正确，所有测试通过
- [ ] ⚠️ **部分成功** - 100kHz正确，但其他频率有误差
- [ ] ❌ **修复失败** - 100kHz仍显示错误

**签字确认**:

测试人员: ________________  日期: __________  
审核人员: ________________  日期: __________

---

## 附录：调试技巧

### 如果100kHz仍显示错误

1. **检查综合报告**
   - 确认代码修改已综合
   - 查看是否有warning/error

2. **检查时序**
   - 运行时序分析
   - 确认无时序违例

3. **检查信号路径**
   - 使用ChipScope/SignalTap抓取内部信号
   - 验证 `freq_temp`, `freq_unit_flag_int`, `freq_result`

4. **对比仿真**
   - 编写testbench
   - 仿真验证计算逻辑

### 如果精度不足

1. **启用FFT测量**（见诊断清单问题#1）
2. **增加测量周期**（100ms → 1s，精度提高10倍）
3. **优化滤波器**（减少平均次数，提高响应速度）

### 联系支持

如果遇到无法解决的问题，请提供：
- [ ] 测试记录表（本文档）
- [ ] 综合报告（.rtr文件）
- [ ] 时序报告（timing summary）
- [ ] 示波器截图（输入信号）
- [ ] HDMI显示照片（错误显示）
